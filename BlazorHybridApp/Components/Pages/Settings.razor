@page "/settings"
@using BlazorHybridApp.Core
@using CommunityToolkit.Maui.Storage
@inject UserSettingsProvider UserSettingsProvider
@inject IFolderPicker FolderPicker;

<MudText Typo="Typo.h6">Account Information</MudText>
<MudDivider Class="mb-3" />
<MudTextField Label="Email" Value="@_settings.Email" ReadOnly="true" Variant="Variant.Filled" />
<MudTextField Label="Sync Location" Value="@_settings.SyncPath" ReadOnly="true" Variant="Variant.Filled" Class="mt-2" Style="padding: 10px;" />
<MudButton OnClick="ChangeSyncLocation" Variant="Variant.Outlined" Color="Color.Primary" Class="mt-2 mb-3">Change Sync Location</MudButton>

@code {
    private UserSettings _settings = new();

    protected override async Task OnInitializedAsync()
    {
        // Fetch the user settings (mocking for now)
        _settings = (await UserSettingsProvider.GetUserSettingsAsync())!;
    }

    private async Task ChangeSyncLocation()
    {
        var result = await FolderPicker.PickAsync();

        if (result.Folder is null)
        {
            return;
        }

        var path = result.Folder.Path;

        await UserSettingsProvider.SelectNewSyncPathAsync(path);
        _settings = (await UserSettingsProvider.GetUserSettingsAsync())!;
    }
}